{% extends "base_breadcrumbs.html" %}
{% set total_messages = thread.total_messages() %}

{% macro render_actions() %}
<div class="mt-3 mb-3 d-flex">
	<div class="d-flex flex-grow-1">
		<a class="btn btn-primary" href="{{ url_for('messages.create', topic_id=topic.id, thread_id=thread.id) }}">
			Post Reply
			<i class="mdi mdi-reply ml-1"></i>
		</a>
	</div>
	<div class="d-flex text-muted align-items-center">
		{{ total_messages }} {{ 'messages' if total_messages > 1 else 'message' }} â€¢
		Page 1 of 1
	</div>
</div>
{% endmacro %}

{% block content %}
	<div id="messages" class="category">
		<h1 class="header mb-3 text-muted">{{ thread.title }}</h1>
		{% for message in messages %}
			<div class="message-container d-flex flex-row bg-white shadow-sm p-3 rounded-lg overflow-hidden">
				<div class="message-user-info">
					{{ message.user.username }}
				</div>
				<div class="message-body flex-grow-1 pl-3">
					<div class="message-body-top d-flex flex-row justify-content-between pb-2 border-bottom border-light text-muted">
							<span class="message-created-timestamp" data-timestamp="{{ message.created_at }}"></span>
							{% if message.user.id == user.id %}
							<div class="message-actions">
								<a href="{{ url_for('messages.edit', topic_id=topic.id, thread_id=thread.id, id=message.id) }}" class="icon-button mr-1" title="edit">
									<i class="button mdi mdi-edit"></i>
								</a>
								<form method="POST" action="{{ url_for('messages.delete', topic_id=topic.id, thread_id=thread.id, id=message.id) }}" class="form">
									{{ form.csrf_token }}
									<button type="submit" class="icon-button" title="delete">
										<i class="button mdi mdi-delete"></i>
									</button>
								</form>
							</div>
							{% endif %}
					</div>
					<div class="message-text pt-2">{{ message.text }}</div>
				</div>
			</div>
		{% endfor %}
	</div>
	{{ render_actions() }}
{% endblock %}